{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Manutenções</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'cadastro_poste/css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'cadastro_poste/css/index.css' %}">
</head>
<body class="p-4">

<style>
  .container {
    padding-top: 4rem;
  }
  .container h2 {
    text-align: center;
  }
</style>

<header class="header-wrapper">
  <div class="row align-items-center">
    <div class="col-6 text-start">
      <img src="{% static 'cadastro_poste/img/logo.svg' %}" alt="Logo IluminaJá" class="header-img img-fluid">
    </div>
    
  </div>
</header>

<div class="container">
  <h2 class="mb-4 text-primary text-center">Manutenções</h2>

  <a href="{% url 'manutencao:criar_manutencao' %}" class="btn btn-success mb-3">+ Nova Manutenção</a>

  {% if messages %}
  <div class="container mt-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
      </div>
    {% endfor %}
  </div>
  {% endif %}

    <form method="get" class="mb-3 d-flex">
    <input type="text" name="busca" class="form-control me-2" placeholder="Buscar por poste, lâmpada, tipo, status ou responsável" value="{{ busca }}">
    <button class="btn btn-primary">Buscar</button>
    </form>



  <table class="table table-striped">
    <thead>
      <tr>
        <th>Poste</th>
        <th>Lâmpada</th>
        <th>Data</th>
        <th>Tipo</th>
        <th>Descrição</th>
        <th>Status</th>
        <th>Responsável</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for manutencao in manutencoes %}
      <tr>
        <td>{{ manutencao.poste }}</td>
        <td>{% if manutencao.lampada %}{{ manutencao.lampada }}{% else %}-{% endif %}</td>
        <td>{{ manutencao.data_manutencao|date:"d/m/Y" }}</td>
        <td>{{ manutencao.get_tipo_display }}</td>
        <td>{{ manutencao.descricao|default:"-" }}</td>
        <td>{{ manutencao.get_status_display }}</td>
        <td>{% if manutencao.responsavel %}{{ manutencao.responsavel.get_full_name|default:manutencao.responsavel.username }}{% else %}-{% endif %}</td>
        <td>
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modalEditar{{ manutencao.id }}">
              Editar
            </button>

            <form method="post" action="{% url 'manutencao:excluir_manutencao' manutencao.id %}" onsubmit="return confirm('Deseja mesmo excluir esta manutenção?');">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-danger">Excluir</button>
            </form>
          </div>
        </td>
      </tr>

      <div class="modal fade" id="modalEditar{{ manutencao.id }}" tabindex="-1" aria-labelledby="modalLabel{{ manutencao.id }}" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <form method="post" action="{% url 'manutencao:editar_manutencao' manutencao.id %}">
              {% csrf_token %}
              <div class="modal-header">
                <h5 class="modal-title" id="modalLabel{{ manutencao.id }}">Editar Manutenção #{{ manutencao.id }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="poste{{ manutencao.id }}" class="form-label">Poste</label>
                  <select name="poste" id="poste{{ manutencao.id }}" class="form-select" required>
                    {% for poste in postes %}
                      <option value="{{ poste.id }}" {% if poste.id == manutencao.poste.id %}selected{% endif %}>{{ poste }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="mb-3">
                  <label for="lampada{{ manutencao.id }}" class="form-label">Lâmpada</label>
                  <select name="lampada" id="lampada{{ manutencao.id }}" class="form-select">
                    <option value="" {% if not manutencao.lampada %}selected{% endif %}>Nenhuma</option>
                    {% for lampada in lampadas %}
                      <option value="{{ lampada.id }}" {% if manutencao.lampada and lampada.id == manutencao.lampada.id %}selected{% endif %}>{{ lampada }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="mb-3">
                  <label for="data_manutencao{{ manutencao.id }}" class="form-label">Data da Manutenção</label>
                  <input type="date" name="data_manutencao" id="data_manutencao{{ manutencao.id }}" class="form-control" value="{{ manutencao.data_manutencao|date:'Y-m-d' }}" required>
                </div>
                <div class="mb-3">
                  <label for="tipo{{ manutencao.id }}" class="form-label">Tipo</label>
                  <select name="tipo" id="tipo{{ manutencao.id }}" class="form-select" required>
                    {% for valor, nome in manutencao.TIPO_MANUTENCAO_CHOICES %}
                      <option value="{{ valor }}" {% if valor == manutencao.tipo %}selected{% endif %}>{{ nome }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="mb-3">
                  <label for="descricao{{ manutencao.id }}" class="form-label">Descrição</label>
                  <textarea name="descricao" id="descricao{{ manutencao.id }}" class="form-control" rows="3">{{ manutencao.descricao }}</textarea>
                </div>
                <div class="mb-3">
                  <label for="status{{ manutencao.id }}" class="form-label">Status</label>
                  <select name="status" id="status{{ manutencao.id }}" class="form-select" required>
                    {% for valor, nome in manutencao.STATUS_CHOICES %}
                      <option value="{{ valor }}" {% if valor == manutencao.status %}selected{% endif %}>{{ nome }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="modal-footer modal-footer-inline">
                <button type="submit" class="btn btn-success">Salvar</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      {% endfor %}
    </tbody>
  </table>
</div>

<footer class="footer-custom text-white mt-5">
  <div class="footer-content d-flex flex-column flex-md-row justify-content-between align-items-start px-4 py-4">
    <div>
      <img src="{% static 'cadastro_poste/img/logo.svg' %}" alt="Logo" class="footer-logo">
    </div>
    <div class="d-flex gap-5">
      <div>
        <p class="footer-title">Política de Privacidade</p>
        <p class="footer-title">Sobre Nós</p>
      </div>
      <div>
        <p class="footer-title">Contato</p>
        <p class="footer-sub">(77) 9.9999-9999</p>
        <p class="footer-sub">Email@gmail.com</p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
